BuildingType
    name = "BLD_TERRAFORM"
    description = "BLD_TERRAFORM_DESC"
    buildcost = 200 * Target.SizeAsDouble * [[BUILDING_COST_MULTIPLIER]]
    buildtime = (6 + Target.SizeAsDouble)
    location = And [
        Planet
        Not Contains Building name = "BLD_TERRAFORM"
        OwnedBy empire = Source.Owner
        TargetPopulation low = 1
        Not Planet type = [Asteroids GasGiant]
        Not Planet environment = [Uninhabitable Good]
        Not And [
            Species name = "SP_EXOBOT"
            Planet environment = Adequate
        ]
    ]
    effectsgroups = [
        EffectsGroup
            scope = And [
                Object id = Source.PlanetID
                Planet
                Not HasSpecial name = "UNSTABLE_SPECIAL"
                Not Planet type = LocalCandidate.NextBetterPlanetType
            ]
            effects = [
                SetPlanetType type = Target.NextBetterPlanetType
                GenerateSitRepMessage
                    message = "EFFECT_TERRAFORM"
                    label = "EFFECT_TERRAFORM_LABEL"
                    icon = "icons/building/terraform.png"
                    parameters = tag = "planet" data = Target.ID
                    empire = Source.Owner
                AddSpecial name = "UNSTABLE_SPECIAL" capacity = Target.DistanceFromOriginalType + Target.SizeAsDouble
            ]

        EffectsGroup
            scope = And [
                Object id = Source.PlanetID
                Planet
                HasSpecialCapacity name = "UNSTABLE_SPECIAL" high = 1
            ]
            effects = RemoveSpecial name = "UNSTABLE_SPECIAL"

        EffectsGroup
            scope = And [
                Object id = Source.PlanetID
                Planet
                HasSpecialCapacity name = "UNSTABLE_SPECIAL" low = 2
            ]
            effects = SetSpecialCapacity name = "UNSTABLE_SPECIAL" value = Value - 1
    ]
    icon = "icons/building/terraform.png"

#include "/scripting/common/base_prod.macros"
